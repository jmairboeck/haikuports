SUMMARY="A windowing toolkit for use with Tcl"
DESCRIPTION="Tk is a graphical user interface toolkit that takes developing desktop \
applications to a higher level than conventional approaches. Tk is the \
standard GUI not only for Tcl, but for many other dynamic languages, and \
can produce rich, native applications that run unchanged across Windows, \
Mac OS X, Linux and more."
HOMEPAGE="http://www.tcl.tk"
COPYRIGHT="Regents of the University of California, Sun Microsystems, Inc., Scriptics Corporation, and other parties"
LICENSE="TCL"
REVISION="1"
SOURCE_URI="https://sourceforge.net/projects/tcl/files/Tcl/$portVersion/tk$portVersion-src.tar.gz"
CHECKSUM_SHA256="8ffdb720f47a6ca6107eac2dd877e30b0ef7fac14f3a84ebbd0b3612cee41a94"
SOURCE_DIR="tk$portVersion"
PATCHES="tk-$portVersion.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

commandBinDir=$binDir
commandSuffix=$secondaryArchSuffix
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	tk$secondaryArchSuffix = $portVersion compat >= 8.6
	cmd:wish$commandSuffix = $portVersion compat >= 8.6
	cmd:wish8.6$commandSuffix = $portVersion compat >= 8.6
	lib:libtk8.6$secondaryArchSuffix = $portVersion compat >= 8.6
	"
REQUIRES="
	haiku$secondaryArchSuffix
	tcl$secondaryArchSuffix
	lib:libx11$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

PROVIDES_devel="
	tk${secondaryArchSuffix}_devel = $portVersion
	devel:libtk8.6$secondaryArchSuffix = $portVersion
	devel:libtkstub8.6$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	tk$secondaryArchSuffix == $portVersion base
	"
CONFLICTS_devel="
	xlibe${secondaryArchSuffix}_devel
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	tcl${secondaryArchSuffix}_devel
	devel:libx11$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:autoconf
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	local _64bit="--disable-64bit"
	case "$targetArchitecture" in
		*64*)
			_64bit="--enable-64bit"
			;;
	esac

	cd unix

	autoconf -f
	runConfigure --omit-dirs binDir ./configure \
		--bindir=$commandBinDir \
		--with-tcl=$(finddir B_SYSTEM_DEVELOP_DIRECTORY)/lib$secondaryArchSubDir \
		--enable-man-symlinks $_64bit

	make
}

INSTALL()
{
	cd unix
	make install install-private-headers

	ln -s wish8.6 "${commandBinDir}/wish"

	sed -i -e "s#${sourceDir}/unix#${developLibDir}#" \
		-e "s#${sourceDir}#${includeDir}#" \
		${libDir}/tkConfig.sh

	prepareInstalledDevelLib libtkstub8.6
	fixPkgconfig

	mv $libDir/tkConfig.sh $developLibDir
	packageEntries devel \
		$developDir
}

TEST()
{
	cd unix
	make test
}
